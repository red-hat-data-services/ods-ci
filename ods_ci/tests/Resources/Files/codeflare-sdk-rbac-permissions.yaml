---
# RBAC permissions for test user to run e2e tests
# Apply this as cluster-admin before running tests:
#   oc apply -f tests/Resources/Files/codeflare-sdk-rbac-permissions.yaml
#   OR
#   kubectl apply -f tests/Resources/Files/codeflare-sdk-rbac-permissions.yaml
#
# Replace "ldap-admin1" with your actual test username

# For OpenShift: Grant self-provisioner role (allows namespace creation)
# This is the recommended approach for OpenShift
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: test-user-self-provisioner
  # For OpenShift, you can also use: oc adm policy add-cluster-role-to-user self-provisioner ldap-admin1
subjects:
- kind: User
  name: ldap-admin1
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: self-provisioner
  apiGroup: rbac.authorization.k8s.io
---
# Alternative: Grant admin role (more permissive, use if self-provisioner doesn't work)
# For OpenShift, you can also use: oc adm policy add-cluster-role-to-user admin ldap-admin1
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: test-user-admin
subjects:
- kind: User
  name: ldap-admin1
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: admin
  apiGroup: rbac.authorization.k8s.io
---
# For Kubernetes: Grant cluster-admin role (allows all operations including namespace creation)
# This is more permissive but ensures all test operations work
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: test-user-cluster-admin
subjects:
- kind: User
  name: ldap-admin1
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
---
# Additional permissions for Kueue resources (if needed)
# This allows the user to create/manage Kueue CustomResources
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: test-user-kueue-admin
rules:
- apiGroups:
  - kueue.x-k8s.io
  resources:
  - clusterqueues
  - resourceflavors
  - localqueues
  - workloads
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: test-user-kueue-admin
subjects:
- kind: User
  name: ldap-admin1
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: test-user-kueue-admin
  apiGroup: rbac.authorization.k8s.io
---
# Permissions for RayCluster and RayJob CustomResources
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: test-user-ray-admin
rules:
- apiGroups:
  - ray.io
  resources:
  - rayclusters
  - rayjobs
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: test-user-ray-admin
subjects:
- kind: User
  name: ldap-admin1
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: test-user-ray-admin
  apiGroup: rbac.authorization.k8s.io

